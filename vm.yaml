imports:
  - path: itemp.py

resources:
- name: "target-pool"
  type: "compute.v1.targetPool"
  properties:
    region: "us-east1"
    instances: []
    healthChecks:
    - $(ref.health-check.selfLink)
- name: "health-check"
  type: "compute.v1.httpHealthCheck"
  properties:
    requestPath: “/”
    checkIntervalSec: 10
- name: "forwarding-rule"
  type: "compute.v1.forwardingRule"
  properties:
    region: "us-east1"
    portRange: "80"
    IPProtocol: TCP
    target: $(ref.target-pool.selfLink)
- name: "instance-group"
  type: "compute.v1.instanceGroupManager"
  properties:
    zone: "us-east1-a"
    targetSize: 2
    baseInstanceName: "www"
    instanceTemplate: $(ref.tmpl.selfLink)
    targetPools:
      - $(ref.target-pool.selfLink)
- name: tmpl
  type: itemp.py
  properties:
    tags:
      items:
        - http-server
    metadata:
      items:
        - key: startup-script
          value: "
          #!/bin/bash\n
          apt-get update\n
          apt-get install -y apache2\n
          echo '<!doctype html><html><body><h1>Hi FizzBuzz! www01</h1></body></html>' | sudo tee /var/www/html/index.html
          "
